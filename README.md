# AI-technologies
Кришталь Кирилл Евгеньевич, группа 6231-010402D
1 Лабораторная 
Создание Docker-образа (Dockerfile)
Используется официальный образ Ubuntu версии 22.04
Обновление пакетов и установка зависимостей: Выполняется обновление списка пакетов и установка необходимых инструментов и библиотек для сборки и работы с OpenCV и Python.
Переменные окружения: Устанавливается версия Python и путь для установленных пакетов.
опирование зависимостей Python: Файл requirements.txt копируется в контейнер для установки Python-зависимостей.
Скачивание и сборка OpenCV
Создание директории для OpenCV: Создаётся папка /opt/opencv
Скачивание исходного кода OpenCV и модулей contrib
Сборка и установка OpenCV
Настройка рабочей директории и копирование файлов
Устанавливается директория /workspace как рабочая.
Копируются папки scripts/ и images/ из локальной системы в контейнер.
По умолчанию при запуске контейнера открывается оболочка Bash

Python-скрипт для обработки изображений (image_processing.py)
Используются библиотеки OpenCV (cv2), NumPy (numpy) и стандартный модуль os
Функция гамма-коррекции
Вычисляется обратная гамма.
Создаётся таблица преобразования для каждого значения пикселя.
Применяется преобразование с помощью функции cv2.LUT.
Функция выделения контуров
Преобразует изображение в оттенки серого.
Применяет алгоритм Canny для выделения краёв.
Конвертирует одноцветное изображение обратно в цветное для сохранения формата.
Главная функция main()

Определение путей к файлам
Проверка существования входного изображения
Загрузка изображения
Применение гамма-коррекции и сохранение результата
Выделение контуров и сохранение результата

Общий процесс выполнения лабораторной работы

Сборка Docker-образа

Запустим команду docker build -t image_processing_lab . в директории с Dockerfile.
Docker создаст контейнер, устанавливая все необходимые зависимости и собирая OpenCV с дополнительными модулями.

Запуск контейнера:
Запустим контейнер командой docker run -it image_processing_lab.

Выполнение скрипта обработки изображений:

Перейдем в директорию scripts

Запустим Python-скрипт 
Скрипт обработает изображение input.jpg, применит гамма-коррекцию и выделит контуры, сохранив результаты в соответствующие файлы.
2 Лаболаторная 
Файл docker-compose.yml
build: .: Строит образ из текущей директории, используя Dockerfile.
volumes: Монтирует локальные папки images/input и images/output в контейнер для доступа к изображениям.
command: Запускает скрипт yolo_image.py при старте контейнера.
deploy.resources.reservations.devices: Резервирует GPU для контейнера.
environment: Переменная окружения для видимости всех GPU.
runtime: nvidia: Использует NVIDIA runtime для доступа к GPU.
restart: unless-stopped: Автоматически перезапускает контейнер в случае сбоя, кроме случаев ручной остановки.

Файл Dockerfile
Базовый образ: Используется PyTorch образ с поддержкой CUDA для работы с GPU.
Установка системных пакетов: Устанавливаются необходимые библиотеки и инструменты для сборки и работы с OpenCV, YOLOv5 и другими зависимостями.
Рабочая директория: Устанавливается /workspace как основная директория внутри контейнера.
Установка Python-зависимостей: Копируется requirements.txt и устанавливаются необходимые пакеты через pip.
Установка YOLOv5 зависимостей: Устанавливаются дополнительные зависимости из официального репозитория YOLOv5.
Копирование скриптов: Скрипты обработки изображений копируются в контейнер.
Создание директорий: Создаются папки для входных и выходных изображений.
Команда по умолчанию: При запуске контейнера автоматически выполняется скрипт yolo_image.py.

Скрипт yolo_image.py
Инициализация:
Определяет устройство (cuda или cpu).
Загружает модель YOLOv5 (yolov5s.pt).


Методы:
score_image: Обрабатывает изображение, возвращая метки, координаты и уверенность обнаруженных объектов.
class_to_label: Преобразует числовую метку в строковое название класса.
plot_boxes: Рисует bounding boxes и метки на изображении.

process_images: Обрабатывает все изображения из папки input, применяет обнаружение объектов и сохраняет результаты в папку output.

Запуск:
Создает экземпляр ObjectDetection.
Определяет пути к входным и выходным директориям.
Запускает обработку изображений.

Общий процесс выполнения лабораторной работы

Сборка Docker-образа

docker-compose build

Docker соберет образ, устанавливая все необходимые зависимости и настройки для работы с YOLOv5 и GPU.

Запуститм сервис yolov5 с помощью Docker Compose:

docker-compose up

Контейнер запустится, смонтирует локальные папки для входных и выходных изображений и начнет выполнение скрипта yolo_image.py
Обработка изображений:
Поместите изображения для обработки в локальную папку images/input.

Скрипт автоматически обнаружит изображения, выполнит обнаружение объектов и сохранит обработанные изображения в images/output.
Просмотр результатов:
После завершения обработки проверьте папку images/output для просмотра результатов с нанесенными bounding boxes и метками объектов.
3 Лаболаторная 
docker-compose.yml

version: '3.8': Указывает версию Docker Compose.

services: Определяет сервисы, в данном случае один сервис server.

build: ./server: Строит образ из директории ./server, где находится Dockerfile.
container_name: Назначает имя контейнера image_processing_server.

ports: Пробрасывает порт 8000 внутри контейнера на порт 8080 хоста.

restart: unless-stopped: Автоматически перезапускает контейнер при сбоях, кроме случаев ручной остановки.

Dockerfile

Базовый образ: Используется облегчённый образ Python 3.10.

Установка системных пакетов: Устанавливаются необходимые библиотеки для работы с изображениями и другими зависимостями.

Установка Python-зависимостей: Копируется requirements.txt и устанавливаются пакеты через pip.

Копирование серверного кода: Файл main.py копируется в рабочую директорию.

Экспонирование порта: Открывается порт 8000 для доступа к серверу.

Запуск приложения: Используется Gunicorn с Uvicorn workers для запуска FastAPI приложения.

Main.py

Инициализация FastAPI: Создаётся экземпляр приложения.

Загрузка модели YOLOv5: Используется предобученная модель yolov5s.




Эндпоинт /process-image/:

Принимает загруженное изображение.

Обрабатывает изображение моделью YOLOv5 для обнаружения объектов.

Возвращает JSON с результатами обнаружения и обработанное изображение в формате base64.


client_app.py

Графический интерфейс:
Кнопка для загрузки изображения.
Отображение загруженного и обработанного изображений.

Функция load_image:
Открывает диалоговое окно для выбора изображения.
Отображает выбранное изображение в интерфейсе.
Отправляет изображение на сервер для обработки.

Функция send_image:
Отправляет изображение на сервер через API.
Получает результаты обнаружения и обработанное изображение.
Отображает обработанное изображение и результаты обнаружения пользователю.

Общий процесс выполнения лабораторной работы

Сборка Docker-образа и запуск сервера

docker-compose up --build

Docker Compose соберет образ из директории ./server, установит все зависимости и запустит контейнер сервера.

Сервер будет доступен на http://localhost:8080.

Использование клиентского приложения:

Запустим client_app.py
В интерфейсе приложения нажмем кнопку "Загрузить изображение" и выберите изображение для обработки.

Приложение отправит изображение на сервер, получит результаты обнаружения и отобразит как исходное, так и обработанное изображение с bounding boxes и метками объектов.

Просмотр результатов:
После обработки изображений результаты отображаются в клиентском приложении.

Детекции выводятся в виде сообщений, а обработанные изображения показывают обнаруженные объекты.
